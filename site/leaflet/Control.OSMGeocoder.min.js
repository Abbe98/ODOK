/*! Source: https://github.com/k4r573n/leaflet-control-osm-geocoder
Date: 2015-01-01 */
if(typeof console=="undefined"){this.console={log:function(e){}}}L.Control.OSMGeocoder=L.Control.extend({options:{collapsed:true,position:"topright",text:"Locate",bounds:null,email:null,callback:function(e){if(e.length==0){console.log("ERROR: didn't find a result");return}var t=e[0].boundingbox,n=new L.LatLng(t[0],t[2]),r=new L.LatLng(t[1],t[3]),i=new L.LatLngBounds([n,r]);this._map.fitBounds(i)}},_callbackId:0,initialize:function(e){L.Util.setOptions(this,e)},onAdd:function(e){this._map=e;var t="leaflet-control-geocoder",n=this._container=L.DomUtil.create("div",t);L.DomEvent.disableClickPropagation(n);var r=this._form=L.DomUtil.create("form",t+"-form");var i=this._input=document.createElement("input");i.type="text";var s=document.createElement("input");s.type="submit";s.value=this.options.text;r.appendChild(i);r.appendChild(s);L.DomEvent.addListener(r,"submit",this._geocode,this);if(this.options.collapsed){L.DomEvent.addListener(n,"mouseover",this._expand,this);L.DomEvent.addListener(n,"mouseout",this._collapse,this);var o=this._layersLink=L.DomUtil.create("a",t+"-toggle",n);o.href="#";o.title="Nominatim Geocoder";L.DomEvent.addListener(o,L.Browser.touch?"click":"focus",this._expand,this);this._map.on("movestart",this._collapse,this)}else{this._expand()}n.appendChild(r);return n},_createSearchResult:function(e,t){var n=.005;var r=[];r[0]={};r[0]["boundingbox"]=[parseFloat(e)-n,parseFloat(e)+n,parseFloat(t)-n,parseFloat(t)+n];r[0]["class"]="boundary";r[0]["display_name"]="Position: "+e+" "+t;r[0]["lat"]=e;r[0]["lon"]=t;return r},_isLatLon:function(e){var t=/(-?\d+\.\d+)\s(-?\d+\.\d+)/;var n=t.exec(e);if(n!=undefined)return n;t=/lat\D*(-?\d+\.\d+)\D*lon\D*(-?\d+\.\d+)/;n=t.exec(e);if(n!=undefined)return n;else return null},_isLatLon_decMin:function(e){console.log("is LatLon?: "+e);re=/([ns])\s*(\d+)\D*(\d+\.\d+).?\s*([ew])\s*(\d+)\D*(\d+\.\d+)/i;m=re.exec(e.toLowerCase());if(m!=undefined)return m;else return null},_geocode:function(e){L.DomEvent.preventDefault(e);var t=this._input.value;if(this._isLatLon(t)!=null){var n=this._isLatLon(t);console.log("LatLon: "+n[1]+" "+n[2]);this.options.callback.call(this,this._createSearchResult(n[1],n[2]));return}else if(this._isLatLon_decMin(t)!=null){var n=this._isLatLon_decMin(t);var r=new Array;r["n"]=1;r["s"]=-1;r["e"]=1;r["w"]=-1;this.options.callback.call(this,this._createSearchResult(r[n[1]]*(Number(n[2])+n[3]/60),r[n[4]]*(Number(n[5])+n[6]/60)));return}console.log(this._callbackId);window["_l_osmgeocoder_"+this._callbackId]=L.Util.bind(this.options.callback,this);var i={q:this._input.value,json_callback:"_l_osmgeocoder_"+this._callbackId++,format:"json"};if(this.options.bounds&&this.options.bounds!=null){if(this.options.bounds instanceof L.LatLngBounds){i.viewbox=this.options.bounds.toBBoxString();i.bounded=1}else{console.log("bounds must be of type L.LatLngBounds");return}}if(this.options.email&&this.options.email!=null){if(typeof this.options.email=="string"){i.email=this.options.email}else{console.log("email must be a string")}}var s=location.protocol;var o=s+"//nominatim.openstreetmap.org/search"+L.Util.getParamString(i),u=document.createElement("script");u.type="text/javascript";u.src=o;u.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(u)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded","")}})
